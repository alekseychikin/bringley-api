# [API Брингли v1.0: подключение интернет-магазинов](http://bringley.ru/api/1.0/)
## PHP-реализация

### Инициализация

Чтобы получить экземпляр объекта АПИ, нужно вызвать следующий метод:

```
$order = BringleyAPI::newOrder('bestpizza', '892bb3493cb9e1491a78a55579ce7ee9');
```

Он принимает два параметра: псевдоним организации и API_KEY.

Все методы возвращают `$this`, так что можно вызывать методы цепочкой.

Чтобы добавить позицию, нужно вызвать метод `addPosition`. Он принимает массив с параметрами, которые описаны в документации с АПИ. Пример:

```
$order->addPosition(array(
  'position' => '52',
  'count' => 2,
  'options' => array('43'),
  'discount' => 20,
  'discount_type' => 'percents'
));
```
Общая скидка задаётся методом `discount`. Он принимает два параметра: `discount` и `discount_type` из документации АПИ. Пример:

```
$order->discount('10', 'percents');
```

Мы задали 10-процентную скидку на весь заказ.

Метаданные о заказе указываются методом `order`. Он принимает массив из параметров, которые описаны в документации АПИ. Пример:

```
->order(array(
  'phone' => '927 123-12-34',
  'name' => 'Евгения',
  'payment' => 'cash',
  'delivery' => 'none',
  'city' => 'Москва',
  'street' => 'пер. Молочный',
  'house' => '6',
  'entrance' => '2',
  'floor' => 6,
  'flat' => '44'
));
```

Если все данные собраны, отправить запрос можно методом `done`. Он принимает переменную `$error` по ссылке. После выполнения запроса, туда запишется ошибка. Переменная `$error` представляет собой массив из двух элементов: `code` и `message`. Если запрос прошёл успешно, то `code` будет равен `200`.

Этот метод, `->done()`, возвращает некоторый ответ-массив. В случае ошибки (`code` не равен `200`), там будет элемент `error`, который будет содержать описание ошибки. Например, если передать несуществующий ID позиции, то `$result['error']` будет содержать примерно следующее:

```
Position with id 522222 does not exists
```

А переменная $error следующее (`print_r($error)`):
```
Array
(
  [code] => 422
  [message] => Unprocessable Entity
)
```
